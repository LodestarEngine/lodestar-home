<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://ldstr.dev/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://ldstr.dev/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://ldstr.dev/fonts/KaTeX_Main-Regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://ldstr.dev/fonts/KaTeX_Math-Italic.woff2 type=font/woff2 crossorigin><script>(()=>{var b=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,a=localStorage.getItem("theme");b&&a===null&&(localStorage.setItem("theme","dark"),document.documentElement.setAttribute("data-dark-mode","")),b&&a==="dark"&&document.documentElement.setAttribute("data-dark-mode",""),a==="dark"&&document.documentElement.setAttribute("data-dark-mode","")})()</script><link rel=stylesheet href=https://ldstr.dev/main.3ee4b1ed1e3a792c679e858301d307cd1af99858efa8f43d0c5b412a18276ca6c828941aeecf92b8f92ed4d70fdb8ada016ff68beaac2d2f5f15ea7909f3b2a6.css integrity="sha512-PuSx7R46eSxnnoWDAdMHzRr5mFjvqPQ9DFtBKhgnbKbIKJQa7s+SuPku1NcP24raAW/2i+qsLS9fFep5CfOypg==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>PID Controller - Lodestar</title><meta name=description content="A simple proportional-integral-derivative controller."><link rel=canonical href=https://ldstr.dev/docs/recipes/pid/><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:title" content="PID Controller"><meta property="og:description" content="A simple proportional-integral-derivative controller."><meta property="og:url" content="https://ldstr.dev/docs/recipes/pid/"><meta property="og:site_name" content="Lodestar"><meta property="article:published_time" content="2022-03-01T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-01T00:00:00+00:00"><meta property="og:image" content="https://ldstr.dev/doks.png"><meta property="og:image:alt" content="Lodestar"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content><meta name=twitter:creator content><meta name=twitter:title content="PID Controller"><meta name=twitter:description content="A simple proportional-integral-derivative controller."><meta name=twitter:image content="https://ldstr.dev/doks.png"><meta name=twitter:image:alt content="PID Controller"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://ldstr.dev/#/schema/organization/1","name":"Lodestar","url":"https://ldstr.dev/","sameAs":["https://github.com/helkebir/Lodestar"],"logo":{"@type":"ImageObject","@id":"https://ldstr.dev/#/schema/image/1","url":"https://ldstr.dev/logo-doks.png","width":512,"height":512,"caption":"Lodestar"},"image":{"@id":"https://ldstr.dev/#/schema/image/1"}},{"@type":"WebSite","@id":"https://ldstr.dev/#/schema/website/1","url":"https://ldstr.dev/","name":"Lodestar","description":"An integrated real-time control engine in C\u002b\u002b11.","publisher":{"@id":"https://ldstr.dev/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://ldstr.dev/docs/recipes/pid/","url":"https://ldstr.dev/docs/recipes/pid/","name":"PID Controller","description":"A simple proportional-integral-derivative controller.","isPartOf":{"@id":"https://ldstr.dev/#/schema/website/1"},"about":{"@id":"https://ldstr.dev/#/schema/organization/1"},"datePublished":"2022-03-01T00:00:00CET","dateModified":"2022-03-01T00:00:00CET","breadcrumb":{"@id":"https://ldstr.dev/docs/recipes/pid/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://ldstr.dev/docs/recipes/pid/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://ldstr.dev/docs/recipes/pid/"]}]},{"@type":"BreadcrumbList","@id":"https://ldstr.dev/docs/recipes/pid/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://ldstr.dev/","url":"https://ldstr.dev/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@type":"WebPage","@id":"https://ldstr.dev/docs/","url":"https://ldstr.dev/docs/","name":"Docs"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://ldstr.dev/docs/recipes/","url":"https://ldstr.dev/docs/recipes/","name":"Recipes"}},{"@type":"ListItem","position":4,"item":{"@id":"https://ldstr.dev/docs/recipes/pid/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://ldstr.dev/#/schema/article/1","headline":"PID Controller","description":"A simple proportional-integral-derivative controller.","isPartOf":{"@id":"https://ldstr.dev/docs/recipes/pid/"},"mainEntityOfPage":{"@id":"https://ldstr.dev/docs/recipes/pid/"},"datePublished":"2022-03-01T00:00:00CET","dateModified":"2022-03-01T00:00:00CET","author":{"@id":"https://ldstr.dev/#/schema/person/2"},"publisher":{"@id":"https://ldstr.dev/#/schema/organization/1"},"image":{"@id":"https://ldstr.dev/docs/recipes/pid/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://ldstr.dev/#/schema/person/2","name":"Hamza El-Kebir","sameAs":["https://github.com/szm-dev"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://ldstr.dev/docs/recipes/pid/#/schema/image/2","url":"https://ldstr.dev/doks.png","contentUrl":"https://ldstr.dev/doks.png","caption":"PID Controller"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://ldstr.dev/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://ldstr.dev/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://ldstr.dev/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://ldstr.dev/site.webmanifest></head><body class="docs single"><div id=announcement class="alert alert-primary alert-dismissible fade show d-none text-lg-center" role=alert>A paper on Lodestar is now available on arXiv: <a class="alert-link stretched-link" href=https://arxiv.org/abs/2203.00649/>arXiv:2203.00649</a>
<button type=button class=btn-close data-bs-dismiss=alert aria-label=Close></button></div><div class=header-bar></div><header class="navbar navbar-expand-md navbar-light doks-navbar"><nav class="container-xxl flex-wrap flex-md-nowrap" aria-label="Main navigation"><a class="navbar-brand p-0 me-auto" href=/ aria-label=Lodestar>Lodestar</a>
<button class="btn btn-menu d-block d-md-none order-5" type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasDoks aria-controls=offcanvasDoks aria-label="Open main menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg></button><div class="offcanvas offcanvas-start border-0 py-md-1" tabindex=-1 id=offcanvasDoks data-bs-backdrop=true aria-labelledby=offcanvasDoksLabel><div class="header-bar d-md-none"></div><div class="offcanvas-header d-md-none"><h2 class="h5 offcanvas-title ps-2" id=offcanvasDoksLabel><a class=text-dark href=/>Lodestar</a></h2><button type=button class="btn-close text-reset me-2" data-bs-dismiss=offcanvas aria-label="Close main menu"></button></div><div class="offcanvas-body px-4"><h3 class="h6 text-uppercase mb-3 d-md-none">Main</h3><ul class="nav flex-column flex-md-row ms-md-n3"><li class=nav-item><a class="nav-link ps-0 py-1" href=/blog/>Blog</a></li><li class=nav-item><a class="nav-link ps-0 py-1 active" href=/docs/prologue/introduction/>Docs</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://docs.ldstr.dev/>C++ Reference</a></li><li class=nav-item><a class="nav-link ps-0 py-1" href=https://theory.ldstr.dev/>Theory</a></li></ul><hr class="text-black-50 my-4 d-md-none"><h3 class="h6 text-uppercase mb-3 d-md-none">Socials</h3><ul class="nav flex-column flex-md-row ms-md-auto me-md-n5 pe-md-2"><li class=nav-item><a class="nav-link ps-0 py-1" href=https://github.com/helkebir/Lodestar><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg><small class="ms-2 d-md-none">GitHub</small></a></li></ul></div></div><button id=mode class="btn btn-link order-md-1" type=button aria-label="Toggle user interface mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button></nav></header><nav class="doks-subnavbar py-2 sticky-lg-top" aria-label="Secondary navigation"><div class="container-xxl d-flex align-items-md-center"><form class="doks-search position-relative flex-grow-1 me-auto"><input id=search class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded d-none"></div></form><button class="btn doks-sidebar-toggle d-lg-none ms-3 order-3 collapsed" type=button data-bs-toggle=collapse data-bs-target=#doks-docs-nav aria-controls=doks-docs-nav aria-expanded=false aria-label="Toggle documentation navigation"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-expand" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Expand</title><polyline points="7 13 12 18 17 13"/><polyline points="7 6 12 11 17 6"/></svg><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="doks doks-collapse" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><title>Collapse</title><polyline points="17 11 12 6 7 11"/><polyline points="17 18 12 13 7 18"/></svg></button></div></nav><div class=container-xxl><aside class=doks-sidebar><nav id=doks-docs-nav class="collapse d-lg-none" aria-label="Tertiary navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-prologue aria-expanded=false>
Prologue</button><div class=collapse id=section-prologue><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/prologue/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=/docs/prologue/quick-start/>Quick Start</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-concepts aria-expanded=false>
Concepts</button><div class=collapse id=section-concepts><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/concepts/features/>Features</a></li><li><a class="docs-link rounded" href=/docs/concepts/rationale/>Rationale</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-blocks aria-expanded=false>
Blocks</button><div class=collapse id=section-blocks><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/blocks/gainblock/>GainBlock</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-development aria-expanded=false>
Development</button><div class=collapse id=section-development><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/development/codestyle/>Code Style</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-recipes aria-expanded=true>
Recipes</button><div class="collapse show" id=section-recipes><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded active" href=/docs/recipes/pid/>PID Controller</a></li><li><a class="docs-link rounded" href=/docs/recipes/lqr/>LQR Controller</a></li></ul></div></li></ul></nav></aside></div><div class="wrap container-xxl" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar d-none d-lg-block"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-prologue aria-expanded=false>
Prologue</button><div class=collapse id=section-prologue><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/prologue/introduction/>Introduction</a></li><li><a class="docs-link rounded" href=/docs/prologue/quick-start/>Quick Start</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-concepts aria-expanded=false>
Concepts</button><div class=collapse id=section-concepts><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/concepts/features/>Features</a></li><li><a class="docs-link rounded" href=/docs/concepts/rationale/>Rationale</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-blocks aria-expanded=false>
Blocks</button><div class=collapse id=section-blocks><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/blocks/gainblock/>GainBlock</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-development aria-expanded=false>
Development</button><div class=collapse id=section-development><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=/docs/development/codestyle/>Code Style</a></li></ul></div></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-recipes aria-expanded=true>
Recipes</button><div class="collapse show" id=section-recipes><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded active" href=/docs/recipes/pid/>PID Controller</a></li><li><a class="docs-link rounded" href=/docs/recipes/lqr/>LQR Controller</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#gathering-the-ingredients>Gathering the Ingredients</a></li><li><a href=#preparing-the-blocks>Preparing the Blocks</a></li><li><a href=#linking-the-blocks>Linking the Blocks</a></li><li><a href=#executing-the-program>Executing the Program</a></li><li><a href=#going-beyond>Going Beyond</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=/>Home</a></li><li class=breadcrumb-item><a href=/docs/>Docs</a></li><li class=breadcrumb-item><a href=/docs/recipes/>Recipes</a></li><li class="breadcrumb-item active" aria-current=page>PID Controller</li></ol></nav><h1>PID Controller</h1><p class=lead>A simple proportional-integral-derivative controller.</p><nav class=d-xl-none aria-label="Quaternary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#gathering-the-ingredients>Gathering the Ingredients</a></li><li><a href=#preparing-the-blocks>Preparing the Blocks</a></li><li><a href=#linking-the-blocks>Linking the Blocks</a></li><li><a href=#executing-the-program>Executing the Program</a></li><li><a href=#going-beyond>Going Beyond</a></li></ul></nav></div></nav><div class="alert alert-warning d-flex" role=alert><div class="flex-shrink-1 alert-icon">❓</div><div class=w-100>For more background on PID controllers, see <a href=https://theory.ldstr.dev/pid/>this theory page</a>.</div></div><p>In this recipe, we will prepare a simple discretized PID controller. As a bonus, we show how to take this prebaked controller to the next level by programming a PID controller with anti-windup from scratch.</p><h2 id=gathering-the-ingredients>Gathering the Ingredients <a href=#gathering-the-ingredients class=anchor aria-hidden=true>#</a></h2><p>You will need the following standard library blocks:</p><ul><li><code>ConstantBlock</code>, for a constant setpoint.</li><li><code>SumBlock</code>, to add and subtract signals.</li><li><code>GainBlock</code>, to multiply signals with a fixed gain.</li></ul><p>Include them as follows:</p><pre><code class=language-cpp>#include &lt;Lodestar/blocks/std/ConstantBlock.hpp&gt;
#include &lt;Lodestar/blocks/std/SumBlock.hpp&gt;
#include &lt;Lodestar/blocks/std/GainBlock.hpp&gt;
#include &lt;Lodestar/blocks/std/SimplePIDBlock.hpp&gt;
</code></pre><p>To make life easier for ourselves and reduce the amount of typing, let&rsquo;s add the following two <code>using namespace</code> declarations:</p><pre><code class=language-cpp>using namespace ls::blocks;
using namespace ls::blocks::std;
</code></pre><div class="alert alert-warning d-flex" role=alert><div class="flex-shrink-1 alert-icon">⚠️</div><div class=w-100>Using `using` declarations pollutes your namespace and can cause name clashes; use them in moderation.</div></div><h2 id=preparing-the-blocks>Preparing the Blocks <a href=#preparing-the-blocks class=anchor aria-hidden=true>#</a></h2><p>We start by declaring our constant setpoint, which we assume to be a <code>double</code>:</p><pre><code class=language-cpp>ConstantBlock&lt;double&gt; constBlk{0.5};
</code></pre><p>You can change the constant any time before running the loop as follows:</p><pre><code class=language-cpp>constBlk.constant() = -0.5;
</code></pre><div class="alert alert-warning d-flex" role=alert><div class="flex-shrink-1 alert-icon">⚠️</div><div class=w-100>Don't change constants while your program is running; there are better ways of doing this (shown just below).</div></div><p>Now it&rsquo;s time to introduce the summation that computes our error (setpoint minus the system&rsquo;s output):</p><pre><code class=language-cpp>// The number of inputs to the summation is 2, and the type is `double`, hence &lt;double, 2&gt;.
SumBlock&lt;double, 2&gt; sumBlk;
</code></pre><p>You should know that a <code>SumBlock</code> assumes that all its inputs should just be added; we want to subtract the second input. To do this, we set the operators as follows:</p><pre><code class=language-cpp>sumBlk.setOperators(decltype(sumBlk)::Plus, decltype(sumBlk)::Minus);
</code></pre><p>At this point, everything is ready for a PID controller. We are taking a shortcut here, directly using the <code>SimplePIDBlock</code> (don&rsquo;t worry, a more advanced example follows just after this).</p><pre><code class=language-cpp>SimplePIDBlock&lt;double&gt; pidBlk;
pidBlk.pGain() = 1;
pidBlk.iGain() = 0.2;
pidBlk.dGain() = 0.1;
pidBlk.samplingPeriod() = 1e-3;
</code></pre><p>Based on the code above, it should be clear that we are setting the proportional, derivative, and integral gains, as well as the sampling period, in that exact order. We link these blocks together next.</p><h2 id=linking-the-blocks>Linking the Blocks <a href=#linking-the-blocks class=anchor aria-hidden=true>#</a></h2><p>We will need to introduce two more <code>include</code>s add the top of the code: one for our <code>connect</code> function, and the other for the <code>Executor</code>, which will figure out how to run our blocks.</p><pre><code class=language-cpp>#include &lt;Lodestar/blocks/BlockUtilities.hpp&gt; // connect function
#include &lt;Lodestar/blocks/aux/Executor.hpp&gt; // Executor
</code></pre><p>We&rsquo;re now getting to the fun part: connecting the blocks. It should be quite obvious to see what we&rsquo;re after: the error should go into the PID block, and the constant should go into the first input of the sum.</p><pre><code class=language-cpp>connect(sumBlk.o&lt;0&gt;(), pidBlk.i&lt;0&gt;());
connect(constBlk.o&lt;0&gt;(), sumBlk.i&lt;0&gt;());
</code></pre><p>Here&rsquo;s a pro tip for when you start taking on more advanced systems; you can <em>alias</em> signals as follows:</p><pre><code class=language-cpp>auto &amp;e = sumBlk.o&lt;0&gt;();
auto &amp;s0 = sumBlk.i&lt;0&gt;();
auto &amp;s1 = sumBlk.i&lt;1&gt;();
auto &amp;sp = constBlk.o&lt;0&gt;();
auto &amp;pid = pidBlk.i&lt;0&gt;();
auto &amp;u = pidBlk.o&lt;0&gt;();

connect(sp, s0);
connect(e, pid);
</code></pre><p>If you keep track of your naming conventions, this can feel a lot closer to drawing a block diagram by hand!</p><h2 id=executing-the-program>Executing the Program <a href=#executing-the-program class=anchor aria-hidden=true>#</a></h2><p>We&rsquo;re missing one crucial component: a physical system. This is were the possibilities start to expand; you can declare your <em>own</em> blocks in Lodestar and directly interface with them.</p><p>For now, let&rsquo;s keep things simple, going for a one-step time delay (<code>DelayBlock</code>) instead:</p><pre><code class=language-cpp>#include &lt;Lodestar/blocks/std/DelayBlock.hpp&gt;

DelayBlock&lt;double&gt; sysBlk;
// Set the initial value to be 5.
sysBlk.clear(5);
</code></pre><p>The final interconnections read:</p><pre><code class=language-cpp>connect(pidBlk.o&lt;0&gt;(), sysBlk.i&lt;0&gt;());
connect(sysBlk.o&lt;0&gt;(), sumBlk.i&lt;1&gt;());
</code></pre><p>Or, in case you&rsquo;re using those handy aliases:</p><pre><code class=language-cpp>connect(u, sysBlk.i&lt;0&gt;());
connect(sysBlk.o&lt;0&gt;(), s1);
</code></pre><div class="alert alert-warning d-flex" role=alert><div class="flex-shrink-1 alert-icon">⚠️</div><div class=w-100>Be aware of your `connection`s; Lodestar will complain if you connect incompatible signals, or if you try to connect two or more outputs to a single input. Also, you can't use and input as an output (for obvious reasons).</div></div><p>We&rsquo;re now ready to run the code. First, however, we need to let Lodestar know what we&rsquo;re working with. To do that, Lodestar uses <code>BlockPack</code>s; as the name suggests, these are packs of blocks:</p><pre><code class=language-cpp>BlockPack bp{pidBlk, constBlk, sumBlk, sysBlk};
</code></pre><p>Now, we can pass this <code>BlockPack</code> to an <code>Executor</code>, which allows us to resolve the execution order:</p><pre><code class=language-cpp>aux::Executor ex{bp};
ex.resolveExecutionOrder();
</code></pre><p>That&rsquo;s it, you can now run a single iteration of your loop (known as <code>trigger</code>ing in Lodestar parlance):</p><pre><code class=language-cpp>ex.trigger();
</code></pre><p>To actually see our program in action, let&rsquo;s include <code>&lt;iostream></code>, and run the following code:</p><pre><code class=language-cpp>for (int i=0; i&lt;50; i++) {
    ex.trigger();
    
    // Print the system output
    ::std::cout &lt;&lt; i &lt;&lt; &quot;: &quot; &lt;&lt; sysBlk.o&lt;0&gt;().object &lt;&lt; ::std::endl;
}
</code></pre><p>And there you have it, your first PID controller in Lodestar!</p><h2 id=going-beyond>Going Beyond <a href=#going-beyond class=anchor aria-hidden=true>#</a></h2><p>We will need some more blocks to cook up our <em>advanced</em> PID controller:</p><ul><li><code>SaturationBlock</code>, to limit our integral value.</li><li><code>DeadzoneBlock</code>, to prevent small oscillations in case of small errors.</li><li><code>DelayBlock</code>, to be able to perform Euler integration and backward differentiation.</li></ul><pre><code class=language-cpp>#include &lt;Lodestar/blocks/std/SaturationBlock.hpp&gt;
#include &lt;Lodestar/blocks/std/DeadzoneBlock.hpp&gt;
#include &lt;Lodestar/blocks/std/DelayBlock.hpp&gt;
</code></pre><p>Now, for the block initialization:</p><pre><code class=language-cpp>GainBlock&lt;double&gt; Kp{1};
GainBlock&lt;double&gt; Ki{0.2};
GainBlock&lt;double&gt; Kd{0.1};
GainBlock&lt;double&gt; periodInv{1e3};
GainBlock&lt;double&gt; period{1e-3};

DelayBlock&lt;double&gt; delayDiff, delayInt;

SaturationBlock&lt;double&gt; satInt;

satInt.lower() = -1;
satInt.upper() = 1;

SumBlock&lt;double, 2&gt; sumDiff, sumInt;
sumDiff.setOperators(decltype(sumDiff)::Plus, decltype(sumDiff)::Minus);

SumBlock&lt;double, 3&gt; sumPID;

SaturationBlock&lt;double&gt; satBlk;
satBlk.lower() = -2;
satBlk.upper() = 2;

DeadzoneBlock&lt;double&gt; dzBlk;
dzBlk.lower() = -0.05;
dzBlk.upper() = 0.05;
</code></pre><p>You can see that we introduced a couple of gains, some delays and sums, and a saturation and deadzone block. Initializing these block is pretty straightforward as shown.
We can now start linking them together.</p><pre><code class=language-cpp>// Proportional
connect(sumBlk.o&lt;0&gt;(), Kp.i&lt;0&gt;());
connect(Kp.o&lt;0&gt;(), sumPID.i&lt;0&gt;());

// Integral
connect(sumInt.o&lt;0&gt;(), satInt.i&lt;0&gt;());
connect(satInt.o&lt;0&gt;(), delayInt.i&lt;0&gt;());
connect(delayInt.o&lt;0&gt;(), sumInt.i&lt;0&gt;());
connect(sumBlk.o&lt;0&gt;(), period.i&lt;0&gt;());
connect(period.o&lt;0&gt;(), sumInt.i&lt;1&gt;());
connect(satInt.o&lt;0&gt;(), Ki.i&lt;0&gt;());
connect(Ki.o&lt;0&gt;(), sumPID.i&lt;1&gt;());

// Differential
connect(sumBlk.o&lt;0&gt;(), sumDiff.i&lt;0&gt;());
connect(sumBlk.o&lt;0&gt;(), delayDiff.i&lt;0&gt;());
connect(delayDiff.o&lt;0&gt;(), sumDiff.i&lt;1&gt;());
connect(sumDiff.o&lt;0&gt;(), periodInv.i&lt;0&gt;());
connect(periodInv.o&lt;0&gt;(), Kd.i&lt;0&gt;());
connect(Kd.o&lt;0&gt;(), sumPID.i&lt;2&gt;());

// Error computation
connect(constBlk.o&lt;0&gt;(), sumBlk.i&lt;0&gt;());
connect(dzBlk.o&lt;0&gt;(), sumBlk.i&lt;1&gt;());

// Saturation
connect(sumPID.o&lt;0&gt;(), satBlk.i&lt;0&gt;());

// Deadzone
connect(sysBlk.o&lt;0&gt;(), dzBlk.i&lt;0&gt;());

// Control interconnection
connect(satBlk.o&lt;0&gt;(), sysBlk.i&lt;0&gt;());
</code></pre><p>Most of the code above is straightforward, but the integral and differential parts might need to be reread to see how things link up. This is where a block diagram could come in handy (Lodestar can generate those for you, but we&rsquo;ll get into that in another article!).</p><p>The <code>BlockPack</code>-<code>Executor</code> interaction is the same as above, but now we have a couple more blocks to declare:</p><pre><code class=language-cpp>BlockPack bp{sysBlk, constBlk, sumBlk, satBlk, sumDiff, sumInt, sumPID, satInt,
             Kp, Ki, Kd, period, periodInv, delayInt, delayDiff};

aux::Executor ex{bp};
ex.resolveExecutionOrder();
</code></pre><p>Try running the code below and see what has changed:</p><pre><code class=language-cpp>for (int i=0; i&lt;50; i++) {
    ex.trigger();
    
    // Print the system output
    ::std::cout &lt;&lt; i &lt;&lt; &quot;: &quot; &lt;&lt; sysBlk.o&lt;0&gt;().object &lt;&lt; ::std::endl;
}
</code></pre><div class="docs-navigation d-flex justify-content-between"><a href=/docs/prologue/introduction/><div class="card my-1"><div class="card-body py-2">&larr; Introduction</div></div></a><a class=ms-auto href=/docs/concepts/rationale/><div class="card my-1"><div class="card-body py-2">Rationale &rarr;</div></div></a></div></main></div></div></div><footer class="footer text-muted"><div class=container-xxl><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>© 2022 Hamza El-Kebir</li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline></ul></div></div></div></footer><script src=/js/bootstrap.min.592b9faf6c83a2bda564a377cf82f9a67546b198510a93fdb0728f9622ec22729d44be02fb2ea16c3fe5365ae1806259cd111932ca28e68b66462d6937635bab.js integrity="sha512-WSufr2yDor2lZKN3z4L5pnVGsZhRCpP9sHKPliLsInKdRL4C+y6hbD/lNlrhgGJZzREZMsoo5otmRi1pN2Nbqw==" crossorigin=anonymous defer></script>
<script src=/js/highlight.min.d549b8f79c90fb028c27aeb0fe5f5ac7b28353fd6b0bfe8caefa0ca5ee9fb2bbee34f19033586247696d6a7f9e344d00378030eaf297ab4305118d335464263b.js integrity="sha512-1Um495yQ+wKMJ66w/l9ax7KDU/1rC/6MrvoMpe6fsrvuNPGQM1hiR2ltan+eNE0AN4Aw6vKXq0MFEY0zVGQmOw==" crossorigin=anonymous defer></script>
<script src=/js/vendor/katex/dist/katex.min.849bcb0a26d9f709f5e2355f5188d1c21e07bb04544918a1c2a6d290dc2ebcb9b787ba92911f609242c898b7ce8009c541be9153a357e673818164f829d917fe.js integrity="sha512-hJvLCibZ9wn14jVfUYjRwh4HuwRUSRihwqbSkNwuvLm3h7qSkR9gkkLImLfOgAnFQb6RU6NX5nOBgWT4KdkX/g==" crossorigin=anonymous defer></script>
<script src=/js/vendor/katex/dist/contrib/auto-render.min.916823ec103cf367b71e28a6f01513cb9c3ac6708ccb5229402ec46b8e30a8b25003db694df35d80e9dd666a371f327c6152790617b6256390c164109a90bd4c.js integrity="sha512-kWgj7BA882e3Hiim8BUTy5w6xnCMy1IpQC7Ea44wqLJQA9tpTfNdgOndZmo3HzJ8YVJ5Bhe2JWOQwWQQmpC9TA==" crossorigin=anonymous defer></script>
<script src=/main.min.647c6f9869eb8e24d3f5183f467970dbadd12adeec725e66830376db069558e917e21eb7dd363563443d2c91c5c6557ea3b2864d1f2a78c3f65e676fa19b961b.js integrity="sha512-ZHxvmGnrjiTT9Rg/Rnlw263RKt7scl5mgwN22waVWOkX4h633TY1Y0Q9LJHFxlV+o7KGTR8qeMP2XmdvoZuWGw==" crossorigin=anonymous defer></script>
<script src=https://ldstr.dev/index.min.8b050edcb4bd1a237dba4b0dad12268391dbe2328c349d54085606fdd45cd969c14ce431e72cb0204e3e03a7b481f3176a44de50a7a8f57c7b10604690136d87.js integrity="sha512-iwUO3LS9GiN9uksNrRImg5Hb4jKMNJ1UCFYG/dRc2WnBTOQx5yywIE4+A6e0gfMXakTeUKeo9Xx7EGBGkBNthw==" crossorigin=anonymous defer></script></body></html>